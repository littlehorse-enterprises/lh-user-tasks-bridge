services:
  user-tasks-keycloak:
    ports:
      - "8888:8888"
    image: quay.io/keycloak/keycloak:21.1.1
    healthcheck:
      test: "timeout 5s bash -c ':> /dev/tcp/localhost/8888'"
      timeout: 5s
      retries: 3
      start_period: 5s
    command: [ "start-dev", "--http-port=8888" ]
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_HEALTH_ENABLED: true
  user-tasks-keycloak-configurer:
    image: user-tasks-keycloak-configurer
    build: ./local-dev/keycloak-configurer
    depends_on:
      user-tasks-keycloak:
        condition: service_healthy
    environment:
      - LHCC_KEYCLOAK_CLIENT_SECRET=${LHCC_KEYCLOAK_CLIENT_SECRET}
